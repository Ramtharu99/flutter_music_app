# Quick Reference - Profile Feature

## ğŸ“± User Screens

### Account Screen (Tab 4)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â¬…] My Account      [ğŸ“¡ offline]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         [Profile Image]         â”‚
â”‚     (User Icon if no image)     â”‚
â”‚                                 â”‚
â”‚      John Doe (fullName)        â”‚
â”‚      john@example.com           â”‚
â”‚      +1234567890                â”‚
â”‚      [â­ Premium Badge]         â”‚
â”‚                                 â”‚
â”‚    [  Edit Profile Button ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¥ Downloaded Songs   [â†’]       â”‚
â”‚ â“ Help Center         [â†’]       â”‚
â”‚ ğŸšª Logout             [â†’]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Edit Profile Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â¬…] Edit Profile              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         [Profile Image]         â”‚
â”‚      [ğŸ“· Camera Icon] (upload)  â”‚
â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Full Name                   â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚ John Doe            â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Email (read-only)           â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚ john@example.com    â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Phone Number                â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚ +1234567890         â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  [  Edit Profile Button  ]      â”‚
â”‚   OR                            â”‚
â”‚  [  Cancel ]  [ Save Changes ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ State Transitions

### Profile Image States
```
Default State
    â†“ (User clicks camera)
Image Picker
    â†“ (Image selected)
Uploading State (spinner)
    â†“
Success â† API responds
    â†“ (Snackbar "Success!")
Updated UI
```

### Profile Form States
```
Display State (read-only)
    â†“ (User clicks "Edit Profile")
Edit Mode (fields enabled)
    â†“ (User edits & clicks "Save")
Saving State (loading spinner)
    â†“
Success â† API responds
    â†“ (Snackbar "Success!")
Display Mode (read-only again)
```

## ğŸ”Œ API Calls

### Get Profile
```dart
// Called automatically when opening account screen
final response = await _apiService.getProfile();
// Response: User object with all fields
```

### Update Profile
```dart
// Called when user clicks "Save Changes"
final response = await _apiService.updateProfile(
  name: "New Name",
  phone: "+999999999"
);
// Response: Updated User object
```

### Upload Image
```dart
// Called automatically after image selection
final response = await _apiService.uploadProfileImage(imagePath);
// Response: Updated User object with new profile_image URL
```

## ğŸ“Š Data Binding

### Account Screen
```dart
Obx(() {
  final user = _authController.currentUser;
  // Automatically rebuilds when currentUser changes
  return Column(children: [
    Text(user?.fullName ?? 'Guest'),
    Text(user?.email ?? ''),
    // ... more fields
  ]);
})
```

### Profile Form
```dart
// Form initializes with current user data
void _initializeControllers() {
  final user = _authController.currentUser;
  _nameController = TextEditingController(text: user?.fullName ?? '');
  _phoneController = TextEditingController(text: user?.phone ?? '');
}
```

### Profile Image
```dart
Obx(() {
  final user = _authController.currentUser;
  // Shows server image or newly selected image
  return Container(
    image: DecorationImage(image: networkImage OR fileImage)
  );
})
```

## ğŸ¨ UI Components

### Profile Image Widget
- Size: 120x120 circular with border
- Icon fallback: Icons.person (50x50)
- Camera button: 20x20 in bottom-right corner
- Border color: AppColors.primaryColor

### Custom Text Field
- Label color: white (enabled) or white54 (disabled)
- Border radius: 12
- States: enabled, disabled, focused
- Icons: prefix icon support

### Buttons
- Edit Profile: Outlined button
- Save Changes: Elevated (primaryColor background)
- Cancel: Outlined button

## ğŸ” Field States

### Profile Form Fields
```
Full Name:     [Editable]   [Required]
Email:         [Read-only]  [Disabled]
Phone:         [Editable]   [Optional]
```

## âš™ï¸ Configuration

### Update API Endpoints
File: `lib/core/api/api_config.dart`
```dart
static const String profile = '/me';
static const String updateProfile = '/update-profile';
static const String uploadProfileImage = '/upload-profile';
```

### Image Compression Settings
File: `lib/widgets/profile_image.dart` (line 256)
```dart
maxWidth: 800,
maxHeight: 800,
imageQuality: 80,
```

## ğŸ“ Error Messages

| Scenario | Message | Action |
|----------|---------|--------|
| Image upload fails | "Failed to upload image" | Reset, retry |
| Profile save fails | "Failed to update profile" | Show error, retry |
| Empty name | "Name cannot be empty" | Validate input |
| Network error | Shows in snackbar | Retry when online |

## ğŸ”„ Data Flow Summary

```
User Opens Account Screen
    â†“
Load from AuthController.currentUser
    â†“
Display Profile Info

User Clicks "Edit Profile"
    â†“
Navigate to Edit Screen
    â†“
Initialize Form with Current Data
    â†“
User Edits Form/Image
    â†“
User Clicks Save
    â†“
Send to API
    â†“
Update AuthController
    â†“
UI Updates (via Obx)
    â†“
Return to Display Mode
```

## ğŸ› ï¸ Troubleshooting Quick Fixes

| Problem | Solution |
|---------|----------|
| Profile not showing | Check if login was successful |
| Image not uploading | Verify uploadProfileImage endpoint |
| Form not saving | Check updateProfile endpoint |
| UI not updating | Verify AuthController.updateCurrentUser() called |
| Build stuck | Run: `flutter clean && flutter pub get` |

---

**All code is production-ready! âœ…**
